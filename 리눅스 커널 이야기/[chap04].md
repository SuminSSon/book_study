# Chap 4. free 명령이 숨기고 있는 것들

### 4.1 free
- 시스템의 메모리 사용량 확인
- 전체 메모리 용량, 사용 중인 용량, 그리고 buffers와 cached로 명명되는 캐싱 영역의 용량을 확인하는 데 사용됨

```Shell
free -m # MB 단위로 표시
```

### 4.2 buffers와 cached 영역

버퍼 캐시: 블록 디바이스가 가지고 있는 블록 자체에 대한 캐시

캐싱: 한번 읽은 디스크의 내용을 메모리에 저장해 두어서, 동일한 내용을 읽고자 하면 디스크로 요청하지 않고 메모리로 요청하게 된다.

- bufers와 cached 영역은 시스템의 I/O 성능 향상을 위해서 커널이 사용하는 영역이다.
- 사용 영역이 일정 수준 이상이 되면 커널은 Cache 영역으로 사용하던 영역을 애플리케이션이 사용할 수 있도록 메모리 관리 시스템에 반환한다.


### 4.3 /proc/meminfo 읽기

free 명령은 시스템이 사용하고 있는 전체 메모리와 가용한 메모리의 용량을 볼 수 있지만 각 메모리가 시스템의 어느 부분에 사용되 고 있는지 자세하게 볼 수 없다. -> /proc/meminfo를 통해 자세한 메모리 현황을 볼 수 있다.

- Swap Cached
- Active(anon): 특정 파일의 내용을 저장하고 있는 Page Cache 영역을 제외한 메모리 영역
- Inactive(anon): 비교적 참조된 지 오래되어 Swap 영역으로 이동될 수 있는 메모리 영역
- Active(file): 커널이 I/O 성능 향상을 위해 사용하는 영역
- Inactive(file): 비교적 참조된 지 오래되어 Swap 영역으로 이동될 수 있는 메모리 영역

### 4.4 slab 메모리 영역

- Slab: 커널이 직접 사용하는 영역
- SReclaimable: Slab 영역 중 재사용될 수 있는 영역
- SUnreclaim: Slab 영역 중 재사용될 수 없는 영역

커널은 Slab 할당자를 통해 원하는 메모리 영역을 확보한다. 4KB의 영역을 dentry cache(디렉터리 엔트리들을 저장하고 있는 캐시), inode cache 등 목적별로 나누어 할당한다.

### 4.5 Case Study - Slab 메모리 누수

Slab 영역에서 메모리 누수가 발생할 수 있따. 이를 추적하기 위해 slabtop 명령어를 통해 확인하고 drop cache를 이용하여 캐시 영역 강제 플러싱을 해야한다. 단순히 free 명령어로는 Slab 영역의 메모리 누스는 잡을 ㅅ ㅜ없다.